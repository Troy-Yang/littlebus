(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1076:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(57),o=a.n(c),l=(a(607),a(1101)),i=a(1108),s=a(504),u=a(1084),m=a(1085),d=a(1086),E=a(1087),f=a(1109),p=a(1089),h=a(1102),g=a(93),b=a(1090),v=a(1103),w=a(1091),O=a(1092),T=a(1093),j=a(1105),k=[{id:"admin",name:"admin"},{id:"teacher",name:"teacher"},{id:"student",name:"student"}],y=function(e){return n.a.createElement(u.a,e,n.a.createElement(m.a,null,n.a.createElement(d.a,{source:"username"}),n.a.createElement(d.a,{source:"password"}),n.a.createElement(d.a,{source:"email"}),n.a.createElement(d.a,{source:"phone"}),n.a.createElement(E.a,{source:"userRole",choices:k})))},S=function(e){return n.a.createElement(f.a,e,n.a.createElement(m.a,null,n.a.createElement(p.a,{source:"username"}),n.a.createElement(d.a,{source:"password"}),n.a.createElement(d.a,{source:"email"}),n.a.createElement(d.a,{source:"phone"}),n.a.createElement(E.a,{source:"userRole",choices:k})))},P=function(e){return n.a.createElement(h.a,Object.assign({},e,{perPage:8}),n.a.createElement(g.a,{small:n.a.createElement(b.a,{primaryText:function(e){return e.username},tertiaryText:function(e){return new Date(e.createTime).toLocaleDateString()}}),medium:n.a.createElement(v.a,null,n.a.createElement(w.a,{source:"username"}),n.a.createElement(w.a,{source:"password"}),n.a.createElement(w.a,{source:"userRole"}),n.a.createElement(O.a,{source:"createTime",showTime:!0}),n.a.createElement(T.a,null),n.a.createElement(j.a,null))}))},x=a(1088),I=function(e){return n.a.createElement(u.a,e,n.a.createElement(m.a,null,n.a.createElement(d.a,{source:"name"})))},D=function(e){return n.a.createElement(h.a,Object.assign({},e,{perPage:8}),n.a.createElement(g.a,{small:n.a.createElement(b.a,{primaryText:function(e){return e.name},tertiaryText:function(e){return new Date(e.createTime).toLocaleDateString()},linkType:"show"}),medium:n.a.createElement(v.a,null,n.a.createElement(w.a,{source:"name"}),n.a.createElement(w.a,{source:"sessionId"}),n.a.createElement(O.a,{source:"createTime",showTime:!0}),n.a.createElement(x.a,null),n.a.createElement(j.a,null))}))},N=a(1107),U=a(1106),A=a(1095),L=a(548),C=a(549),J=a(580),R=a(550),B=a(581),V=a(12),F=a(16),z=a(59),W=a(492),M=a(48),_=a(58),X=a(170),$=a(184),q=a.n($),G=a(186),H=a.n(G),K=a(31),Q=a.n(K),Y=a(185),Z=a.n(Y),ee=a(88),te=a.n(ee),ae=a(1094),re=a(294),ne=a(193),ce=a(87),oe=a(551),le=a(145),ie=a.n(le),se=function(e){switch(e){case"user":return"username";case"room":return"name";default:return"id"}},ue=function(e,t,a){var r=function(e,t,a){var r={headers:{}};switch(r.headers.Authorization=localStorage.getItem("token"),e){case F.d:var n=a.pagination,c=n.page,o=n.perPage,l=a.sort,i=l.field,s=l.order,u={sort:JSON.stringify([i,s]),range:JSON.stringify([(c-1)*o,c*o-1]),filter:JSON.stringify(a.filter)};r.url="".concat(t,"?").concat(Object(ce.stringify)(u)),r.url="".concat(t);break;case F.g:r.url="".concat(t,"/").concat(a.id);break;case F.e:var m={filter:JSON.stringify({id:a.ids})};r.url="".concat(t,"?").concat(Object(ce.stringify)(m));break;case F.f:var d=a.pagination,E=d.page,f=d.perPage,p=a.sort,h=p.field,g=p.order,b={sort:JSON.stringify([h,g]),range:JSON.stringify([(E-1)*f,E*f-1]),filter:JSON.stringify(Object(ne.a)({},a.filter,Object(re.a)({},a.target,a.id)))};r.url="".concat(t,"?").concat(Object(ce.stringify)(b));break;case F.h:r.method="PUT",r.data=a.data,r.url="".concat(t,"/").concat(a.id);break;case F.a:r.method="POST",r.data=a.data,r.url="".concat(t);break;case F.b:r.method="DELETE",r.data=a.data,r.url="".concat(t,"/").concat(a.id);break;default:throw new Error("Unsupported fetch action type ".concat(e))}return r}(e,t,a);return ie()(r).then(function(r){return function(e,t,a,r){var n=se(a);switch(t){case F.d:case F.e:var c=e.data.length;if(r.sort&&r.sort.field&&(e.data=Object(oe.orderBy)(e.data,[r.sort.field],[r.sort.order.toLocaleLowerCase()])),r.pagination){var o=(r.pagination.page-1)*r.pagination.perPage,l=o+r.pagination.perPage;e.data=e.data.slice(o,l)}return{data:e.data.map(function(e){return Object.assign(e,{id:e[n]})}),total:c};case F.h:case F.g:case F.a:case F.b:return{data:Object(ne.a)({},e.data,{id:e.data[n]})};default:return{data:e.data}}}(r,e,t,a)}).catch(function(e){if(e.response.status<200||e.response.status>=300)return Promise.reject(e.response)})},me=function(e){return e.headers={},e.headers.Authorization=localStorage.getItem("token"),ie()(e)},de=function(e,t,a){return me(Object(ne.a)({url:e,data:t,method:"post"},a))},Ee=function(e,t){return me(Object(ne.a)({url:e,method:"delete"},t))},fe=a(34),pe=a.n(fe),he=a(94),ge=a.n(he),be=a(45),ve=a(6),we=a(5),Oe=a.n(we),Te=Object(ve.withStyles)(function(e){return Object(ve.createStyles)({deleteButton:{color:e.palette.error.main,"&:hover":{backgroundColor:Object(be.fade)(e.palette.error.main,.12),"@media (hover: none)":{backgroundColor:"transparent"}}}})})(function(e){return n.a.createElement(pe.a,{onClick:e.onClick,label:"Delete",className:Oe()("ra-delete-button",e.classes.deleteButton)},n.a.createElement(ge.a,null))}),je=a(38),ke=a(552),ye=a.n(ke),Se=function(e){function t(){var e,a;Object(L.a)(this,t);for(var r=arguments.length,n=new Array(r),c=0;c<r;c++)n[c]=arguments[c];return(a=Object(J.a)(this,(e=Object(R.a)(t)).call.apply(e,[this].concat(n)))).state={avaibleUsers:[]},a.addUser=function(e){a.doAction(de("room/".concat(a.props.record.name,"/generateToken"),e))},a.deleteUser=function(e){var t=e.token.substring(e.token.length-100);a.doAction(Ee("room/".concat(a.props.record.name,"/token/").concat(encodeURIComponent(t))))},a.extendToken=function(e){var t=e.token.substring(e.token.length-100);a.doAction(de("room/".concat(a.props.record.name,"/extendtoken/").concat(encodeURIComponent(t))))},a.doAction=function(e){var t=a.props,r=t.fetchStart,n=t.fetchEnd,c=t.refreshView,o=t.showNotification;e instanceof Promise&&(r(),e.then(c).catch(function(e){o(e.message,"error")}).finally(n))},a}return Object(B.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fetchStart(),ue(F.d,"user",{pagination:{page:1,perPage:Number.MAX_VALUE},sort:{}}).then(function(t){var a=t.data;e.setState({avaibleUsers:a})}).catch(function(t){e.props.showNotification(t.message,"error")}).finally(function(){e.props.fetchEnd()})}},{key:"render",value:function(){var e=this,t=this.props.record.tokens,a=this.state.avaibleUsers.filter(function(e){return!t.find(function(t){return t.user===e.username})});return n.a.createElement(n.a.Fragment,null,n.a.createElement(q.a,null,n.a.createElement(Z.a,null,n.a.createElement(te.a,null,n.a.createElement(Q.a,null,"User"),n.a.createElement(Q.a,null,"Role"),n.a.createElement(Q.a,null,"Expired Time"),n.a.createElement(Q.a,null))),n.a.createElement(H.a,null,t.map(function(t){return n.a.createElement(te.a,{key:t.user},n.a.createElement(Q.a,null,t.user),n.a.createElement(Q.a,null,t.role),n.a.createElement(Q.a,null,new Date(t.expireTime).toLocaleDateString()),n.a.createElement(Q.a,null,n.a.createElement(z.a,{style:{color:"#3f51b5"},onClick:function(){return e.extendToken(t)}},n.a.createElement(ye.a,null)),n.a.createElement(Te,{onClick:function(){return e.deleteUser(t)}})))}))),n.a.createElement(m.a,{save:this.addUser},n.a.createElement(ae.a,{source:"user",choices:a,optionText:"username",optionValue:"username",validate:Object(W.i)()})))}}]),t}(n.a.Component),Pe={fetchEnd:M.f,fetchStart:M.h,showNotification:_.d,push:je.c,refreshView:X.d},xe=Object(V.b)(null,Pe)(Se),Ie=function(e){return n.a.createElement(N.a,e,n.a.createElement(U.a,null,n.a.createElement(A.a,{label:"summary"},n.a.createElement(w.a,{source:"name"}),n.a.createElement(w.a,{source:"sessionId"}),n.a.createElement(O.a,{source:"createTime"})),n.a.createElement(A.a,{label:"users",path:"users"},n.a.createElement(xe,null))))},De=function(e){var t=e.record,a=void 0===t?{}:t;return n.a.createElement("span",null,function(e){var t=~~(e/3600),a=~~(e%3600/60),r=~~e%60,n="";return t>0&&(n+=t+":"+(a<10?"0":"")),n+=a+":"+(r<10?"0":""),n+=""+r}(a.duration))},Ne=function(e){var t=e.record;return t.url&&n.a.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},"Download")},Ue=function(e){return n.a.createElement(h.a,Object.assign({},e,{perPage:8}),n.a.createElement(g.a,{small:n.a.createElement(b.a,{primaryText:function(e){return e.name},tertiaryText:function(e){return new Date(e.createdAt).toLocaleDateString()}}),medium:n.a.createElement(v.a,null,n.a.createElement(w.a,{source:"name"}),n.a.createElement(w.a,{source:"status"}),n.a.createElement(O.a,{source:"createdAt",showTime:!0}),n.a.createElement(De,{source:"duration"}),n.a.createElement(Ne,{source:"url"}),n.a.createElement(j.a,null))}))},Ae=a(1096),Le=a(1097),Ce=a(1104),Je=a(1098),Re=a(1099),Be=a(1100),Ve=a(148),Fe=function(e){return n.a.createElement(u.a,e,n.a.createElement(Ae.a,null,n.a.createElement(Le.a,{label:"summary"},n.a.createElement(d.a,{source:"title",validate:Object(W.i)()}),n.a.createElement(d.a,{source:"attenders",validate:Object(W.i)()}),n.a.createElement(Ce.a,{label:"room",source:"room",reference:"room"},n.a.createElement(ae.a,{optionText:"name"})),n.a.createElement(Ve.DateTimeInput,{source:"startdate",validate:Object(W.i)()}),n.a.createElement(Ve.DateTimeInput,{source:"enddate",validate:Object(W.i)()}),n.a.createElement(Je.a,{source:"description"})),n.a.createElement(Le.a,{label:"Steaming Setting"},n.a.createElement(p.a,{source:"streamName",validate:Object(W.i)(),defaultValue:"littlebus"}),n.a.createElement(Ve.DateTimeInput,{source:"expiredTime",validate:Object(W.i)()}),n.a.createElement(Re.a,{source:"trialTime"}),n.a.createElement(Be.a,{label:"Is Free?",source:"isFree"}))))},ze=function(e){return n.a.createElement(f.a,e,n.a.createElement(Ae.a,null,n.a.createElement(Le.a,{label:"summary"},n.a.createElement(d.a,{source:"title",validate:Object(W.i)()}),n.a.createElement(d.a,{source:"attenders",validate:Object(W.i)()}),n.a.createElement(Ce.a,{label:"room",source:"room",reference:"room"},n.a.createElement(ae.a,{optionText:"name"})),n.a.createElement(Ve.DateTimeInput,{source:"startdate",validate:Object(W.i)()}),n.a.createElement(Ve.DateTimeInput,{source:"enddate",validate:Object(W.i)()}),n.a.createElement(Je.a,{source:"description"})),n.a.createElement(Le.a,{label:"Steaming Setting"},n.a.createElement(p.a,{source:"streaming.streamName",label:"stream Name",validate:Object(W.i)(),defaultValue:"littlebus"}),n.a.createElement(Ve.DateTimeInput,{source:"streaming.expiredTime",label:"expired time",validate:Object(W.i)()}),n.a.createElement(Re.a,{source:"streaming.trialTime",label:"trail minuts"}),n.a.createElement(Be.a,{label:"Is Free?",source:"streaming.isFree"}))))},We=function(e){return n.a.createElement(h.a,Object.assign({},e,{perPage:8}),n.a.createElement(g.a,{small:n.a.createElement(b.a,{primaryText:function(e){return e.title},tertiaryText:function(e){return new Date(e.createTime).toLocaleDateString()},linkType:"show"}),medium:n.a.createElement(v.a,null,n.a.createElement(w.a,{source:"title"}),n.a.createElement(w.a,{source:"description"}),n.a.createElement(w.a,{source:"attenders"}),n.a.createElement(w.a,{source:"status"}),n.a.createElement(O.a,{source:"startdate",showTime:!0}),n.a.createElement(O.a,{source:"enddate",showTime:!0}),n.a.createElement(O.a,{source:"createTime",showTime:!0}),n.a.createElement(T.a,null),n.a.createElement(j.a,null))}))},Me=a(74),_e=a.n(Me),Xe=a(121),$e=a.n(Xe),qe=a(563),Ge=a.n(qe),He=function(){return n.a.createElement(_e.a,null,n.a.createElement(Ge.a,{title:"Welcome to the Little Bus!"}),n.a.createElement($e.a,null))},Ke=a(79);ie.a.defaults.baseURL="https://akhs7hdl61.execute-api.ap-northeast-1.amazonaws.com/prod/api/";var Qe=function(e,t){if(e===Ke.d){var a={url:"auth/login",method:"POST",data:t};return ie()(a).then(function(e){return e.data}).then(function(e){var t=e.token,a=e.username,r=e.userRole;return localStorage.setItem("token",t),localStorage.setItem("username",a),localStorage.setItem("role",r),Promise.resolve(a)}).catch(function(e){if(e.response.status<200||e.response.status>=300)throw new Error(e.response.data.message)})}if(e===Ke.e)return localStorage.removeItem("username"),Promise.resolve();if(e===Ke.b){var r=t.status;return 401===r||403===r?(localStorage.removeItem("username"),Promise.reject()):Promise.resolve()}return e===Ke.a?localStorage.getItem("username")?Promise.resolve():Promise.reject():Promise.reject("Unknown method")},Ye=a(578),Ze=a.n(Ye),et=a(579),tt=a.n(et),at=a(405),rt=a.n(at),nt=function(){return n.a.createElement(l.a,{loginPage:i.a,dataProvider:ue,authProvider:Qe,dashboard:He},n.a.createElement(s.a,{name:"user",list:P,edit:S,create:y,icon:Ze.a}),n.a.createElement(s.a,{name:"room",list:D,show:Ie,create:I,icon:tt.a}),n.a.createElement(s.a,{name:"schedule",list:We,create:Fe,edit:ze,icon:rt.a}),n.a.createElement(s.a,{name:"archive",list:Ue,icon:rt.a}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(nt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},602:function(e,t,a){e.exports=a(1076)},607:function(e,t,a){}},[[602,1,2]]]);
//# sourceMappingURL=main.a2cbf37f.chunk.js.map